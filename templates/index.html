{% extends "base.html" %}

{% block title %}Smart Card Manager - Dashboard{% endblock %}

{% block content %}
<div class="jumbotron">
    <h1 class="display-4">Welcome to Smart Card Manager!</h1>
    <p class="lead">This is a simple application for managing smart cards.</p>
    <hr class="my-4">
    <p>Use the navigation bar above to access the API Explorer, Configuration Manager, and Logs pages.</p>
    <a class="btn btn-primary btn-lg" href="/api_explorer" role="button">Explore APIs</a>
</div>

<div class="card-operations">
    <h2>Card Operations</h2>
    <div class="form-group">
        <label for="cardId">Card ID:</label>
        <input type="number" id="cardId" class="form-control" placeholder="Enter Card ID">
        <small id="cardIdHelp" class="form-text text-muted">Please enter a valid card ID.</small>
    </div>
    <button id="getCardInfo" class="btn btn-primary">Get Card Info</button>
    <div class="form-group">
        <label for="pin">PIN:</label>
        <input type="password" id="pin" class="form-control" placeholder="Enter PIN">
        <small id="pinHelp" class="form-text text-muted">Please enter your 4-digit PIN.</small>
    </div>
    <button id="authenticateCard" class="btn btn-success">Authenticate Card</button>
    <div id="output" class="mt-3">
        <!-- Output messages will be displayed here -->
    </div>
</div>

<script>
    $(document).ready(function() {
        $("#getCardInfo").click(function() {
            var cardId = $("#cardId").val();
            if (!cardId) {
                $("#output").html("<div class='alert alert-danger'>Please enter a Card ID.</div>");
                return;
            }
            // Add validation for cardId if needed (e.g., isNaN, length)

            $.ajax({
                url: '/api/card/' + cardId, // Replace with your actual API endpoint
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    $("#output").html("<div class='alert alert-success'>Card Info: " + JSON.stringify(data) + "</div>");
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    $("#output").html("<div class='alert alert-danger'>Error: " + textStatus + " - " + errorThrown + "</div>");
                }
            });
        });

        $("#authenticateCard").click(function() {
            var cardId = $("#cardId").val();
            var pin = $("#pin").val();

            if (!cardId || !pin) {
                $("#output").html("<div class='alert alert-danger'>Please enter both Card ID and PIN.</div>");
                return;
            }

            // Add validation for PIN if needed (e.g., length, format)
            if (pin.length !== 4 || isNaN(pin)) {
                $("#output").html("<div class='alert alert-danger'>PIN must be a 4-digit number.</div>");
                return;
            }

            $.ajax({
                url: '/api/card/authenticate', // Replace with your actual API endpoint
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({card_id: cardId, pin: pin}),
                dataType: 'json',
                success: function(data) {
                    if (data.success) {
                        $("#output").html("<div class='alert alert-success'>Authentication Successful!</div>");
                    } else {
                        $("#output").html("<div class='alert alert-danger'>Authentication Failed: " + data.message + "</div>");
                    }
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    $("#output").html("<div class='alert alert-danger'>Error: " + textStatus + " - " + errorThrown + "</div>");
                }
            });
        });
    });
</script>
{% endblock %}